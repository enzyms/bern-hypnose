---
import type { GetStaticPathsOptions, Page } from 'astro';
import { type CollectionEntry, getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Pagination from '../../components/Pagination.astro';
import PostPreview from '../../components/PostPreview.astro';
import siteConfig from '../../data/site-config';

export async function getStaticPaths({ paginate }: GetStaticPathsOptions) {
    const sortItemsByDateDesc = (a: CollectionEntry<'blog'>, b: CollectionEntry<'blog'>) => {
        return new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime();
    };

    const posts = (await getCollection('blog')).sort(sortItemsByDateDesc);
    return paginate(posts, { pageSize: siteConfig.postsPerPage || 4 });
}

type Props = { page: Page<CollectionEntry<'blog'>> };

const { page } = Astro.props;
const blog = page.data;
---

<BaseLayout title="Blog" description="Bern Hypnose â€“ Blog" image={{ src: '/uploads/glowing-blocks.png', alt: 'Blog' }}>
    <div>
        <h1 class="mb-8 text-3xl leading-tight font-black sm:text-5xl sm:leading-tight">Blog</h1>
        {blog.map((post) => <PostPreview post={post} class="mb-12 sm:mb-16" />)}
        <Pagination page={page} class="my-16 sm:my-24" />
    </div>
</BaseLayout>
